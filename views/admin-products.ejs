<%- include('./partials/header') %>

<div class="min-h-screen flex flex-col bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
  <div class="container px-10 py-10 flex flex-grow">
    <!-- Sidebar -->
    <div class="w-[25%] flex flex-col items-start space-y-2">
      <h3 class="text-lg font-semibold text-gray-700 mb-2">Admin Menu</h3>
      <a class="text-blue-600 hover:underline font-semibold" href="/products">ðŸ“¦ All Products</a>
      <a class="text-blue-600 hover:underline" href="/products/create">âž• Create New Product</a>
      <a class="text-blue-600 hover:underline" href="/owners/admin">ðŸ“Š Dashboard</a>
      <a class="text-red-600 hover:underline font-medium" href="/owners/logout">ðŸšª Logout</a>
    </div>

    <!-- Main Content -->
    <main class="w-3/4 bg-white p-8 shadow ml-4 rounded">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">All Products</h2>
        <a href="/products/create" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Add New Product
        </a>
      </div>

      <% if (products && products.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-gray-300">
            <thead>
              <tr class="bg-gray-50">
                <th class="border border-gray-300 px-4 py-2 text-left">Image</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Name</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Brand</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Color</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Price</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Discount</th>
                <th class="border border-gray-300 px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% products.forEach(product => { %>
                <tr class="hover:bg-gray-50">
                  <td class="border border-gray-300 px-4 py-2">
                    <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" 
                         alt="<%= product.name %>" class="w-16 h-16 object-cover rounded">
                  </td>
                  <td class="border border-gray-300 px-4 py-2"><%= product.name %></td>
                  <td class="border border-gray-300 px-4 py-2"><%= product.brand %></td>
                  <td class="border border-gray-300 px-4 py-2"><%= product.color %></td>
                  <td class="border border-gray-300 px-4 py-2">â‚¹<%= product.price %></td>
                  <td class="border border-gray-300 px-4 py-2"><%= product.discount %>%</td>
                  <td class="border border-gray-300 px-4 py-2">
                    <button onclick="deleteProduct('<%= product._id %>')" 
                            class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                      Delete
                    </button>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="text-center py-8">
          <p class="text-gray-600 mb-4">No products found</p>
          <a href="/products/create" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Create First Product
          </a>
        </div>
      <% } %>
    </main>
  </div>
</div>

<script>
  function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product?')) {
      fetch(`/products/delete/${productId}`, {
        method: 'DELETE'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Failed to delete product');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error deleting product');
      });
    }
  }
</script>

<%- include('./partials/footer') %>