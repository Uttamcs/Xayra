<%- include('./partials/header') %>

<div class="max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-md mt-8">
  <!-- Checkout Title -->
  <h1 class="text-2xl font-bold text-gray-800 mb-6">Checkout</h1>

  <!-- Product Summary -->
  <div class="border-b pb-4 mb-6">
    <h2 class="text-xl font-semibold text-gray-700 mb-2">Order Summary</h2>
    
    <% if (typeof product !== 'undefined') { %>
      <!-- Single Product Checkout -->
      <div class="flex items-center gap-4">
        <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" 
             alt="<%= product.name %>" 
             class="h-24 w-24 object-contain rounded-lg border" />
        <div>
          <p class="font-semibold text-gray-800"><%= product.name %></p>
          <div class="flex items-center gap-3 mt-1">
            <p class="text-lg font-bold text-indigo-600">
              ₹ <%= product.price - (product.price * product.discount / 100) %>
            </p>
            <% if(product.discount > 0) { %>
              <p class="text-gray-500 line-through">₹ <%= product.price %></p>
            <% } %>
          </div>
        </div>
      </div>
    <% } else if (typeof cart !== 'undefined' && cart.length > 0) { %>
      <!-- Cart Checkout -->
      <div class="space-y-4">
        <% cart.forEach(item => { %>
          <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">
            <% if (item.product.image) { %>
              <img src="data:image/jpeg;base64,<%= item.product.image.toString('base64') %>" 
                   alt="<%= item.product.name %>" 
                   class="h-16 w-16 object-contain rounded-lg border" />
            <% } else { %>
              <div class="h-16 w-16 bg-gray-200 rounded-lg border flex items-center justify-center">
                <i class="ri-image-line text-gray-400"></i>
              </div>
            <% } %>
            <div class="flex-1">
              <p class="font-semibold text-gray-800"><%= item.product.name %></p>
              <p class="text-sm text-gray-600">Quantity: <%= item.quantity %></p>
              <div class="flex items-center gap-3 mt-1">
                <p class="text-lg font-bold text-indigo-600">
                  ₹ <%= (item.product.price - (item.product.price * (item.product.discount || 0) / 100)) * item.quantity %>
                </p>
                <% if(item.product.discount > 0) { %>
                  <p class="text-sm text-gray-500 line-through">₹ <%= item.product.price * item.quantity %></p>
                <% } %>
              </div>
            </div>
          </div>
        <% }) %>
        
        <!-- Total -->
        <div class="border-t pt-3 mt-4">
          <div class="flex justify-between items-center">
            <span class="text-lg font-semibold text-gray-800">Total Amount:</span>
            <span class="text-xl font-bold text-indigo-600">
              ₹ <% 
                let total = 0;
                cart.forEach(item => {
                  total += (item.product.price - (item.product.price * (item.product.discount || 0) / 100)) * item.quantity;
                });
              %><%= total %>
            </span>
          </div>
        </div>
      </div>
    <% } %>
  </div>

  <!-- Delivery Address Form -->
  <form action="<%= typeof product !== 'undefined' ? '/order/confirm/' + product._id : '/order/confirm-cart' %>" method="POST" class="space-y-6">
    <div>
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Delivery Address</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="text" name="fullName" placeholder="Full Name" required
          class="w-full border rounded-lg p-3 focus:ring focus:ring-indigo-300"/>
        <input type="text" name="phone" placeholder="Phone Number" required
          class="w-full border rounded-lg p-3 focus:ring focus:ring-indigo-300"/>
        <input type="text" name="address" placeholder="Street Address" required
          class="w-full border rounded-lg p-3 focus:ring focus:ring-indigo-300 col-span-2"/>
        <input type="text" name="city" placeholder="City" required
          class="w-full border rounded-lg p-3 focus:ring focus:ring-indigo-300"/>
        <input type="text" name="pincode" placeholder="Pincode" required
          class="w-full border rounded-lg p-3 focus:ring focus:ring-indigo-300"/>
      </div>
    </div>

    <!-- Payment Options -->
    <div>
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Payment Method</h2>
      <div class="space-y-2">
        <label class="flex items-center gap-2">
          <input type="radio" name="paymentMethod" value="cod" checked />
          <span>Cash on Delivery</span>
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="paymentMethod" value="card" />
          <span>Credit/Debit Card</span>
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="paymentMethod" value="upi" />
          <span>UPI</span>
        </label>
      </div>
    </div>

    <!-- Confirm Order -->
    <div class="mt-6">
      <a href="">
        <button type="submit" 
        class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
        Confirm Order
      </button>
      </a>
    </div>
  </form>
</div>

<%- include('./partials/footer') %>
